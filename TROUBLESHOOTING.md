# トラブルシューティング & デバッグガイド

## 🐛 よくある問題と解決方法

### 問題0: フォローアップがループして先に進まない（v2.2で修正済み）

#### 症状
- 「深掘りする」でコメントを入力
- 「もう一度MAPを生成」を押す
- 同じLayer 1の画面に戻ってしまう

#### 原因（v2.1以前）
フォローアップの内容が適切な質問に追加されていなかったため、Layer判定が変わらなかった。

#### 解決策（v2.2で実装済み）
- **Layer 1**: Q2（選択肢）に追加し、決定語を強化
- **Layer 2**: Q3（引き受けるもの）に追加し、責任語を強化
- 自動的にキーワードを補完

#### 確認方法
1. デバッグモード（`?debug=true`）を有効化
2. コンソールログで「現在のLayer」と「新しいLayer」を確認
3. Layer が 1 → 2 または 2 → 3 に変化していることを確認

#### それでもループする場合
フォローアップで以下のキーワードを含めてください：

**Layer 1 → 2への移行:**
- 選ぶ、決める、選択、判断、やる、実行

**Layer 2 → 3への移行:**
- 引き受ける、リスク、責任、代償、覚悟、背負う

---

### 問題1: 「深掘りする」ボタンを押しても次に進まない

#### 解決策A: デバッグモードで確認
URLの末尾に `?debug=true` を追加してアクセスしてください。

例：
```
https://your-username.github.io/pre-judge-suite/?debug=true
```

デバッグ情報（黄色い背景）が表示され、以下が確認できます：
- 現在のLayer
- ボタンの状態

#### 解決策B: ブラウザのコンソールを確認
1. **Chrome/Edge**: `F12` または `Ctrl+Shift+I` (Mac: `Cmd+Option+I`)
2. **Safari**: 開発メニュー → Webインスペクタを表示
3. **Console**タブを開く
4. ボタンをクリック
5. エラーメッセージが表示されていないか確認

正常な場合、以下のようなログが表示されます：
```
Layer 1のボタンを追加しました
深掘りボタンがクリックされました
setupFollowup呼び出し - Layer: 1
step-followupを表示します
showStep呼び出し: step-followup
ステップを表示: step-followup
```

#### 解決策C: キャッシュをクリア
1. ブラウザのキャッシュをクリア
2. ハードリロード (Ctrl+Shift+R / Cmd+Shift+R)
3. もう一度試す

#### 解決策D: 別のブラウザで試す
- Chrome
- Firefox
- Edge
- Safari

いずれかで動作する場合、特定のブラウザの問題です。

---

## 問題2: Layer判定がおかしい

### 確認ポイント
各質問が以下の条件を満たしているか確認：

**Layer 1 → Layer 2への条件:**
- Q2に決定語（選ぶ、決める、転職、買う、別れる、移住、契約など）が含まれている
- 各質問が10文字以上

**Layer 2 → Layer 3への条件:**
- Q3に責任語（引き受ける、失う、責任、代償、リスク、負担、払う、覚悟など）が含まれている
- Q3が20文字以上だとより確実

### テスト入力
Layer 3になる確実な入力例：

**Q1:**
```
営業職から企画職に転職するか迷っている。現在30歳で、今の会社で5年働いているが、新しいことに挑戦したい気持ちと安定を失う不安がある。
```

**Q2:**
```
①今の会社で営業を続ける ②同業他社の企画職に転職する ③異業種の企画職に挑戦する という3つの選択肢がある。
```

**Q3:**
```
転職すると年収が100万円下がる可能性がある。営業の専門性を捨てることになる。失敗したら30代後半で再転職が難しくなる。一方、今のまま続けると新しいスキルが身につかず、将来の選択肢が狭まる。このリスクを引き受ける覚悟が必要。
```

---

## 問題3: JUDGEX²が計測できない

### 原因
Layer 3に到達していない可能性があります。

### 確認方法
MAPで「Layer 3」のバッジが緑色で表示されているか確認。

### 解決策
Q3に「責任語」を追加：
- 引き受ける
- リスク
- 代償
- 負担
- 覚悟
- 犠牲

など

---

## 問題4: GitHubにプッシュしたが404エラー

### 確認ポイント
1. **GitHub Pagesが有効か？**
   - Settings → Pages
   - Source: `main` branch
   - Folder: `/ (root)`

2. **ファイル名が正しいか？**
   - `index.html` (小文字、スペースなし)

3. **URLが正しいか？**
   ```
   https://USERNAME.github.io/REPOSITORY/
   ```
   ※USERNAMEとREPOSITORYは実際の名前に置き換え

4. **デプロイに時間がかかる**
   - 初回は5-10分かかることがある
   - Actions タブで進行状況を確認

---

## 問題5: モバイルでレイアウトが崩れる

### 確認
- 画面を横向きにする
- ズームレベルを調整 (ピンチイン/アウト)

### 既知の問題
一部の古いブラウザではCSS Grid未対応の可能性があります。

---

## 開発者向けデバッグ

### ローカルで確認
```bash
# 簡易HTTPサーバーを起動 (Python)
python -m http.server 8000

# ブラウザで開く
# http://localhost:8000
```

### コンソールログを有効化
app.jsの各関数に `console.log()` が既に追加されています。

### ブレークポイント
Chrome DevToolsで以下にブレークポイントを設定：
- `setupFollowup()`
- `showStep()`
- `displayMap()`

---

## それでも解決しない場合

### 報告してください
GitHubのIssuesで以下の情報と共に報告：

1. 問題の詳細
2. 使用ブラウザとバージョン
3. スクリーンショット
4. コンソールのエラーメッセージ（あれば）

---

**PRE-JUDGE Suite** - トラブルシューティング
