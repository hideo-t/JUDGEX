# 更新履歴

## v2.3 - Googleログインと診断履歴機能を追加 (2026-02-09)

### 🎉 新機能

- **Googleログイン機能**
  - Firebase Authenticationを使用
  - Googleアカウントでログイン可能
  - ログイン/ログアウト機能

- **利用モード選択**
  - **ゲストモード**: ログインなし・履歴保存なし（従来通り）
  - **ログインモード**: Googleログイン・履歴保存あり
  - 同意画面で選択可能

- **診断履歴保存**
  - Firestore Databaseに保存
  - 年月日・時刻を記録
  - バージョン番号を記録
  - Layer、JUDGEX²スコアを記録

- **履歴表示機能**
  - 過去の診断履歴を一覧表示
  - 日時、Layer、スコアを表示
  - 最大50件まで表示

- **成長グラフ**
  - JUDGEX²スコアの推移を可視化
  - 折れ線グラフで表示
  - 2件以上のスコアがある場合に表示

### 🔧 技術実装

- **Firebase SDK**
  - firebase-app-compat.js (v9.22.0)
  - firebase-auth-compat.js (v9.22.0)
  - firebase-firestore-compat.js (v9.22.0)

- **セキュリティ**
  - ユーザーは自分のデータのみアクセス可能
  - Firestoreセキュリティルールで保護

- **データ構造**
  ```
  users/{userId}/sessions/{sessionId}
    - date, version, round
    - inputs (q1, q2, q3, followup)
    - map (layer, stuckPoints, questions)
    - judgex2 (score, label, axes)
  ```

### 📚 ドキュメント

- **FIREBASE_SETUP.md**を追加
  - Firebase設定手順（5ステップ）
  - トラブルシューティング
  - セキュリティ設定

### 🎨 UI改善

- ヘッダーにログイン状態を表示
- ユーザーアバターとメールアドレス表示
- 履歴ボタンを追加
- 利用モード選択カード

### 💡 使い方

1. 同意画面で「ログインモード」を選択
2. 「開始する」をクリック → Googleログイン
3. 診断を実施
4. 「📊 履歴を見る」で過去の記録を確認
5. 成長グラフでスコアの変化を確認

### ⚠️ 注意事項

- ゲストモードでは履歴は保存されません
- ログインモードには Firebase設定が必要です
- 詳しくは FIREBASE_SETUP.md を参照

---

## v2.2 - フォローアップループ問題を修正 (2026-02-09)

### 🐛 重大な修正

- **フォローアップがループする問題を完全修正**
  - Layer1: Q2（選択肢）に追加して決定語を強化
  - Layer2: Q3（引き受けるもの）に追加して責任語を強化
  - フォローアップ後は必ず次のLayerに昇格

### 🔧 改善

- **Layer判定ロジックの大幅改善**
  - より多くのキーワードを検出
  - 文字数も考慮した判定
  - デバッグログで判定過程を追跡可能

- **フォローアップボタンの改善**
  - 5文字以上で有効化（10文字 → 5文字に変更）
  - リアルタイムで文字数をカウント
  - 入力しやすいプレースホルダー追加

- **デバッグ情報の拡充**
  - フォローアップ画面でも現在Layer/目標Layerを表示
  - 入力文字数をリアルタイム表示
  - キーワード検出状況をコンソールログで確認

### 🎯 動作の流れ

**Layer 1（未整理）からの脱出:**
1. 「何がひっかかっていますか？」と質問
2. 回答をQ2に追加 → 決定語を強化
3. Layer 2に昇格

**Layer 2（判断以前）からの脱出:**
1. 「引き受けること/引き受けないことは？」と質問
2. 回答をQ3に追加 → 責任語を強化
3. Layer 3に昇格 → JUDGEX²計測可能

---

## v2.1 - バグ修正とデバッグ機能追加 (2026-02-09)

### 🐛 修正

- **「深掘りする」ボタンが動作しない問題を修正**
  - イベントリスナーの重複を防止
  - e.preventDefault() を追加
  - より確実なイベント処理

### 🔧 追加機能

- **デバッグモード**
  - URLに `?debug=true` を追加すると詳細情報を表示
  - Layer番号とボタン状態が確認可能
  - 開発・トラブルシューティングに便利

- **コンソールログ強化**
  - 各関数の実行をログに記録
  - 問題の特定が容易に

- **視覚的改善**
  - Layer別アクションボタンを強調表示
  - 背景色とシャドウで目立つように
  - ホバー時のアニメーション追加

### 📚 ドキュメント

- **TROUBLESHOOTING.md 追加**
  - よくある問題と解決方法
  - デバッグ方法の詳細ガイド

---

## v2.0 - UX大幅改善 (2026-02-09)

### 🎯 主な改善点

#### 1. **ステップバイステップ入力**
- 3つの質問を一度に表示するのではなく、1問ずつ進める形式に変更
- 各質問に集中できるため、より深く考えられる
- 前の回答を参照しながら次の質問に答えられる

#### 2. **プログレスバー追加**
- 現在の進捗状況が視覚的に分かる
- 「ステップ 1 / 3」のような明確な表示
- あとどれくらいで完了するかが一目瞭然

#### 3. **選択式プリセット**
よくあるパターンをボタンで選択可能：

**Q1（迷い）のプリセット：**
- 💼 転職
- 💔 人間関係
- 🚀 独立・起業
- 🏠 引っ越し・移住
- 💰 大きな買い物
- 📚 継続・退出

**Q2（選択肢）のプリセート：**
- ⚖️ AかBか
- ✅ やる/やらない
- ⏱️ タイミング
- 🎯 複数選択肢

**Q3（引き受けるもの）のプリセート：**
- 💸 経済的リスク
- 👥 人間関係
- ⏳ 時間・キャリア
- 🛡️ 安定の喪失
- 🚫 機会損失
- 😰 失敗のリスク

#### 4. **例文挿入機能**
- 各質問に「📝 例文を見る」ボタンを追加
- ランダムで適切な例文を提案
- 書き方の参考にできる

#### 5. **前の回答の表示**
- Q2では Q1の回答を表示
- Q3では Q1・Q2の回答を表示
- 一貫性のある回答がしやすい

#### 6. **リアルタイムフィードバック**
- 文字数カウンターが常に表示
- 10文字以上で緑色に変化
- 次へボタンは10文字以上で有効化

#### 7. **戻る機能**
- 各ステップで「← 戻る」ボタンを追加
- 前の回答を修正できる
- 安心して進められる

### 🎨 UIの改善

- **プリセットボタン**: ホバー時にアニメーション
- **ステップヘッダー**: 大きなバッジで現在位置を明示
- **前回答表示**: 水色の背景で見やすく
- **アクションボタン**: 右寄せで統一

### 📱 モバイル対応強化

- プリセットボタンが1カラムで表示
- アクションボタンが縦並び
- ステップヘッダーが縦並び

### 🐛 修正

- 文字カウンターの表示形式を統一
- バリデーション警告の表示タイミング改善
- リセット時のクリーンアップ処理強化

---

## v1.0 - 初回リリース (2026-02-08)

- 基本機能の実装
- Layer判定ロジック
- JUDGEX²計測機能
- レーダーチャート描画

---

## 今後の予定

### v2.1（近日公開）
- [ ] LocalStorageでセッション保存
- [ ] エクスポート機能（テキスト）
- [ ] ダークモード

### v3.0（将来）
- [ ] バックエンドAPI実装
- [ ] ユーザー認証
- [ ] セッション履歴管理
- [ ] PDF出力機能
- [ ] 多言語対応

---

**PRE-JUDGE Suite** - より使いやすく、より深く考えられる
