<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase è¨ºæ–­ãƒ„ãƒ¼ãƒ« - PRE-JUDGE Suite</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        h1 {
            color: #2c5f7c;
        }
        .check-item {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .check-item.loading {
            border-left-color: #f39c12;
        }
        .check-item.success {
            border-left-color: #27ae60;
        }
        .check-item.error {
            border-left-color: #e74c3c;
        }
        .status {
            font-weight: bold;
            margin-left: 10px;
        }
        .detail {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: monospace;
        }
        .solution {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-left: 3px solid #2c5f7c;
            border-radius: 4px;
        }
        button {
            background: #2c5f7c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #1a3d52;
        }
        .info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Firebase è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
    <p>PRE-JUDGE Suiteã®Firebaseè¨­å®šã¨ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p>

    <div class="info">
        <strong>ğŸ“ ä½¿ã„æ–¹:</strong><br>
        1. ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã<br>
        2. ã€Œè¨ºæ–­é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
        3. å„é …ç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª<br>
        4. ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°è§£æ±ºæ–¹æ³•ã«å¾“ã†
    </div>

    <button onclick="runDiagnostics()">è¨ºæ–­é–‹å§‹</button>
    <button onclick="testLogin()">ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</button>
    <button onclick="location.reload()">ãƒªã‚»ãƒƒãƒˆ</button>

    <div id="results"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        const results = document.getElementById('results');

        function addCheckItem(title, status, detail = '', solution = '') {
            const item = document.createElement('div');
            item.className = `check-item ${status}`;
            
            let statusText = '';
            let statusIcon = '';
            if (status === 'success') {
                statusText = 'âœ… æ­£å¸¸';
                statusIcon = 'âœ…';
            } else if (status === 'error') {
                statusText = 'âŒ ã‚¨ãƒ©ãƒ¼';
                statusIcon = 'âŒ';
            } else if (status === 'loading') {
                statusText = 'â³ ç¢ºèªä¸­...';
                statusIcon = 'â³';
            }
            
            item.innerHTML = `
                <div><strong>${title}</strong><span class="status">${statusText}</span></div>
                ${detail ? `<div class="detail">${detail}</div>` : ''}
                ${solution ? `<div class="solution"><strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>${solution}</div>` : ''}
            `;
            
            results.appendChild(item);
            return item;
        }

        async function runDiagnostics() {
            results.innerHTML = '';

            // 1. Firebase SDKã®èª­ã¿è¾¼ã¿ç¢ºèª
            const sdkItem = addCheckItem('1. Firebase SDK', 'loading');
            await sleep(500);
            if (typeof firebase !== 'undefined') {
                sdkItem.className = 'check-item success';
                sdkItem.innerHTML = sdkItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âœ… æ­£å¸¸');
                sdkItem.querySelector('.detail')?.remove();
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.textContent = `Firebase SDKãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${firebase.SDK_VERSION}`;
                sdkItem.appendChild(detail);
            } else {
                sdkItem.className = 'check-item error';
                sdkItem.innerHTML = sdkItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âŒ ã‚¨ãƒ©ãƒ¼');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.textContent = 'Firebase SDKãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“';
                sdkItem.appendChild(detail);
                const solution = document.createElement('div');
                solution.className = 'solution';
                solution.innerHTML = '<strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>1. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèª<br>2. CDN URLãŒæ­£ã—ã„ã‹ç¢ºèª';
                sdkItem.appendChild(solution);
                return;
            }

            // 2. firebase-config.jsã®ç¢ºèª
            const configItem = addCheckItem('2. firebase-config.js', 'loading');
            await sleep(500);
            if (typeof firebaseConfig !== 'undefined') {
                if (firebaseConfig.apiKey !== 'YOUR_API_KEY') {
                    configItem.className = 'check-item success';
                    configItem.innerHTML = configItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âœ… æ­£å¸¸');
                    const detail = document.createElement('div');
                    detail.className = 'detail';
                    detail.innerHTML = `ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID: ${firebaseConfig.projectId}<br>authDomain: ${firebaseConfig.authDomain}`;
                    configItem.appendChild(detail);
                } else {
                    configItem.className = 'check-item error';
                    configItem.innerHTML = configItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âŒ ã‚¨ãƒ©ãƒ¼');
                    const detail = document.createElement('div');
                    detail.className = 'detail';
                    detail.textContent = 'è¨­å®šãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ï¼ˆYOUR_API_KEYã®ã¾ã¾ï¼‰';
                    configItem.appendChild(detail);
                    const solution = document.createElement('div');
                    solution.className = 'solution';
                    solution.innerHTML = '<strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>1. FIREBASE_SETUP.mdã‚’å‚ç…§<br>2. Firebase Consoleã‹ã‚‰è¨­å®šã‚’ã‚³ãƒ”ãƒ¼<br>3. firebase-config.jsã«è²¼ã‚Šä»˜ã‘';
                    configItem.appendChild(solution);
                    return;
                }
            } else {
                configItem.className = 'check-item error';
                configItem.innerHTML = configItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âŒ ã‚¨ãƒ©ãƒ¼');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.textContent = 'firebase-config.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“';
                configItem.appendChild(detail);
                return;
            }

            // 3. FirebaseåˆæœŸåŒ–
            const initItem = addCheckItem('3. FirebaseåˆæœŸåŒ–', 'loading');
            await sleep(500);
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                initItem.className = 'check-item success';
                initItem.innerHTML = initItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âœ… æ­£å¸¸');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.textContent = 'Firebaseã‚¢ãƒ—ãƒªãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ';
                initItem.appendChild(detail);
            } catch (error) {
                initItem.className = 'check-item error';
                initItem.innerHTML = initItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âŒ ã‚¨ãƒ©ãƒ¼');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                initItem.appendChild(detail);
                const solution = document.createElement('div');
                solution.className = 'solution';
                solution.innerHTML = '<strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>è¨­å®šæƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                initItem.appendChild(solution);
                return;
            }

            // 4. èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ç¢ºèª
            const authItem = addCheckItem('4. èªè¨¼è¨­å®š', 'loading');
            await sleep(500);
            const auth = firebase.auth();
            if (auth) {
                authItem.className = 'check-item success';
                authItem.innerHTML = authItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âœ… æ­£å¸¸');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.textContent = 'Firebase AuthenticationãŒåˆ©ç”¨å¯èƒ½ã§ã™';
                authItem.appendChild(detail);
            } else {
                authItem.className = 'check-item error';
                authItem.innerHTML = authItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âŒ ã‚¨ãƒ©ãƒ¼');
            }

            // 5. Firestoreã®ç¢ºèª
            const firestoreItem = addCheckItem('5. Firestore Database', 'loading');
            await sleep(500);
            const db = firebase.firestore();
            if (db) {
                firestoreItem.className = 'check-item success';
                firestoreItem.innerHTML = firestoreItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âœ… æ­£å¸¸');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.textContent = 'FirestoreãŒåˆ©ç”¨å¯èƒ½ã§ã™';
                firestoreItem.appendChild(detail);
            } else {
                firestoreItem.className = 'check-item error';
                firestoreItem.innerHTML = firestoreItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âŒ ã‚¨ãƒ©ãƒ¼');
            }

            // 6. æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ç¢ºèª
            const domainItem = addCheckItem('6. æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³', 'loading');
            await sleep(500);
            const currentDomain = window.location.hostname;
            domainItem.className = 'check-item success';
            domainItem.innerHTML = domainItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'ğŸ’¡ ç¢ºèªå¿…è¦');
            const detail = document.createElement('div');
            detail.className = 'detail';
            detail.innerHTML = `ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³: ${currentDomain}<br><br>Firebase Consoleã§ä»¥ä¸‹ã‚’ç¢ºèª:<br>Authentication â†’ Settings â†’ æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³`;
            domainItem.appendChild(detail);
            const solution = document.createElement('div');
            solution.className = 'solution';
            solution.innerHTML = `<strong>ğŸ’¡ ç¢ºèªæ–¹æ³•:</strong><br>1. Firebase Console ã‚’é–‹ã<br>2. Authentication â†’ Settings â†’ æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³<br>3. ã€Œ${currentDomain}ã€ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª<br>4. ãªã‘ã‚Œã°è¿½åŠ ã™ã‚‹`;
            domainItem.appendChild(solution);
        }

        async function testLogin() {
            if (typeof firebase === 'undefined' || !firebase.apps.length) {
                alert('ã¾ãšã€Œè¨ºæ–­é–‹å§‹ã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                return;
            }

            const loginItem = addCheckItem('ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ', 'loading', 'ãƒ­ã‚°ã‚¤ãƒ³ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¾ã™...');
            
            try {
                const auth = firebase.auth();
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.setCustomParameters({ prompt: 'select_account' });
                
                const result = await auth.signInWithPopup(provider);
                
                loginItem.className = 'check-item success';
                loginItem.innerHTML = loginItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âœ… æˆåŠŸ');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.innerHTML = `
                    ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼<br>
                    ãƒ¡ãƒ¼ãƒ«: ${result.user.email}<br>
                    UID: ${result.user.uid}
                `;
                loginItem.appendChild(detail);
                
                // è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                setTimeout(async () => {
                    await auth.signOut();
                    alert('ãƒ†ã‚¹ãƒˆå®Œäº†ã€‚è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚');
                }, 3000);
                
            } catch (error) {
                loginItem.className = 'check-item error';
                loginItem.innerHTML = loginItem.innerHTML.replace('â³ ç¢ºèªä¸­...', 'âŒ å¤±æ•—');
                const detail = document.createElement('div');
                detail.className = 'detail';
                detail.innerHTML = `
                    ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${error.code}<br>
                    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${error.message}
                `;
                loginItem.appendChild(detail);
                
                const solution = document.createElement('div');
                solution.className = 'solution';
                let solutionText = '';
                
                if (error.code === 'auth/unauthorized-domain') {
                    solutionText = `
                        <strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>
                        ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ (${window.location.hostname}) ãŒæ‰¿èªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br><br>
                        1. Firebase Console â†’ Authentication â†’ Settings<br>
                        2. æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ <br>
                        3. ã€Œ${window.location.hostname}ã€ã‚’è¿½åŠ 
                    `;
                } else if (error.code === 'auth/popup-blocked') {
                    solutionText = '<strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¦ãã ã•ã„';
                } else if (error.code === 'auth/popup-closed-by-user') {
                    solutionText = '<strong>ğŸ’¡ æƒ…å ±:</strong><br>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸï¼ˆæ­£å¸¸ï¼‰';
                } else {
                    solutionText = '<strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>TROUBLESHOOTING.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„';
                }
                
                solution.innerHTML = solutionText;
                loginItem.appendChild(solution);
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
